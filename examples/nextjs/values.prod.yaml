# Production Values for Next.js Helm Chart
# Deploy with: helm install myapp ./charts/nextjs -f charts/nextjs/values.prod.yaml -n production --create-namespace

global:
  environment: production

# Image configuration - use production build target
image:
  repository: ghcr.io/5ergiu/nextjs
  pullPolicy: Always

imagePullSecrets:
  - name: ghcr-secret

# Application - production configuration
app:
  enabled: true
  replicaCount: 3  # Multiple replicas for high availability

  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

  resources:
    limits:
      cpu: 2000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Pod Disruption Budget
  pdb:
    enabled: true
    minAvailable: 2

# Traefik IngressRoute
ingressRoute:
  enabled: true
  entryPoints:
    - websecure
  middlewares:
    - headers
    - compress
    - ratelimit
  routes:
    - match: "Host(`app.example.com`)"
      kind: Rule
  tls:
    certResolver: letsencrypt-prod

# Middleware
middleware:
  enabled: true
  rateLimit:
    enabled: true
    average: 100
    burst: 200
  headers:
    enabled: true
    forceSTSHeader: true
    stsSeconds: 31536000
  compress:
    enabled: true
  redirectScheme:
    enabled: true
    scheme: https

# Next.js configuration - production
nextjs:
  publicEnv:
    NEXT_PUBLIC_APP_NAME: "Next.js Production"
    NEXT_PUBLIC_APP_URL: "https://app.example.com"
    NEXT_PUBLIC_API_URL: "https://api.example.com"
    NEXT_PUBLIC_ENABLE_ANALYTICS: "true"

  env:
    NODE_ENV: "production"
    PORT: "3000"
    HOSTNAME: "0.0.0.0"
    NEXT_TELEMETRY_DISABLED: "1"
    LOG_LEVEL: "warn"

    # Database - connect to production database
    DATABASE_URL: "postgresql://user@postgres.databases.svc.cluster.local:5432/nextjs"

    # Redis - connect to production Redis
    REDIS_URL: "redis://redis.databases.svc.cluster.local:6379"

    # Email/SMTP
    SMTP_HOST: "smtp.sendgrid.net"
    SMTP_PORT: "587"
    SMTP_FROM: "noreply@example.com"

    # AWS/S3
    AWS_REGION: "us-east-1"
    AWS_S3_BUCKET: "nextjs-prod-assets"

  secrets:
    DATABASE_PASSWORD: ""  # Set via sealed secrets
    REDIS_PASSWORD: ""
    API_SECRET_KEY: ""
    AWS_ACCESS_KEY_ID: ""
    AWS_SECRET_ACCESS_KEY: ""
    SMTP_USER: ""
    SMTP_PASSWORD: ""
    NEXTAUTH_SECRET: ""
    NEXTAUTH_URL: "https://app.example.com"

# Persistence - for user uploads in production
persistence:
  enabled: true
  storageClass: "fast-ssd"
  size: 50Gi
