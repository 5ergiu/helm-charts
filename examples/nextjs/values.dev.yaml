# Development Values for Next.js Helm Chart (Local Kubernetes)
# Deploy with: helm install myapp-dev ./charts/nextjs -f charts/nextjs/values.dev.yaml -n development --create-namespace
#
# PREREQUISITES FOR LOCAL DEVELOPMENT:
# 1. Local Kubernetes cluster (Docker Desktop, Minikube, or Kind)
# 2. Traefik ingress controller: helm install traefik traefik/traefik -n traefik --create-namespace
# 3. PostgreSQL (optional): helm install postgres bitnami/postgresql -n development
# 4. Redis (optional): helm install redis bitnami/redis -n development
# 5. Add to /etc/hosts: 127.0.0.1 nextjs.local

global:
  environment: development

# Image configuration - use development build target
image:
  repository: ghcr.io/5ergiu/nextjs
  pullPolicy: Always
  tag: dev

# Application - local development configuration
app:
  enabled: true
  replicaCount: 1  # Single replica for development

  strategy:
    type: Recreate  # Faster for development, no rolling updates

  # Minimal resources for local development
  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

  # Service configuration for local access
  service:
    type: LoadBalancer  # Or NodePort for local access
    port: 80
    targetPort: 3000

  # Disable probes for faster startup in development
  livenessProbe:
    enabled: false
  readinessProbe:
    enabled: false
  startupProbe:
    enabled: false

  # Autoscaling - disabled for development
  autoscaling:
    enabled: false

  # PDB - disabled for development
  pdb:
    enabled: false

  # Security context - match your host user for volume mounts
  # Run: id -u && id -g to get your IDs
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000  # CHANGE THIS: id -u
    fsGroup: 1000    # CHANGE THIS: id -g

# Ingress - local access
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web  # HTTP only
  hosts:
    - host: nextjs.local
      paths:
        - path: /
          pathType: Prefix
  tls: []  # No TLS for local development

# Traefik IngressRoute - disabled, using standard Ingress
ingressRoute:
  enabled: false

# Middleware - relaxed for development
middleware:
  enabled: true
  rateLimit:
    enabled: false  # No rate limiting in dev
  headers:
    enabled: true
    forceSTSHeader: false  # No HTTPS enforcement
  compress:
    enabled: true
  redirectScheme:
    enabled: false  # No HTTPS redirect

# Next.js configuration - development settings
nextjs:
  publicEnv:
    NEXT_PUBLIC_APP_NAME: "Next.js Dev"
    NEXT_PUBLIC_APP_URL: "http://nextjs.local"
    NEXT_PUBLIC_API_URL: "http://nextjs.local/api"
    NEXT_PUBLIC_ENABLE_ANALYTICS: "false"

  env:
    NODE_ENV: "development"
    PORT: "3000"
    HOSTNAME: "0.0.0.0"
    NEXT_TELEMETRY_DISABLED: "1"
    LOG_LEVEL: "debug"  # Verbose logging

    # Database - connect to local PostgreSQL in k8s
    DATABASE_URL: "postgresql://postgres:password@postgres.development.svc.cluster.local:5432/nextjs"

    # Redis - connect to local Redis in k8s
    REDIS_URL: "redis://redis-master.development.svc.cluster.local:6379"

    # Email - use Mailpit for local testing
    SMTP_HOST: "mailpit.development.svc.cluster.local"
    SMTP_PORT: "1025"
    SMTP_FROM: "dev@nextjs.local"

    # AWS/S3 - use local MinIO or disable
    AWS_REGION: "us-east-1"
    AWS_S3_BUCKET: "nextjs-dev"

  # Secrets - NOT FOR PRODUCTION!
  secrets:
    DATABASE_PASSWORD: "password"
    REDIS_PASSWORD: ""
    API_SECRET_KEY: "dev-secret-key-not-for-production"
    AWS_ACCESS_KEY_ID: ""
    AWS_SECRET_ACCESS_KEY: ""
    SMTP_USER: ""
    SMTP_PASSWORD: ""
    NEXTAUTH_SECRET: "dev-nextauth-secret-not-for-production"
    NEXTAUTH_URL: "http://nextjs.local"

# Persistence - enabled for local development
persistence:
  enabled: true
  storageClass: ""  # Use default storage class
  accessMode: ReadWriteOnce
  size: 5Gi  # Smaller size for local
  mounts:
    - name: storage
      mountPath: /app/public/uploads
      subPath: uploads

# Extra environment variables for development
extraEnv:
  - name: NEXT_DEV_MODE
    value: "true"
  - name: WATCHPACK_POLLING
    value: "true"  # Better file watching in Docker

# Init containers - verify build
initContainers:
  verifyBuild:
    enabled: true
