{{- if and .Values.web.enabled .Values.web.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: {{ include "laravel.fullname" . }}-web
  labels:
    {{- include "laravel.deployment.labels" (dict "root" . "component" "web") | nindent 4 }}
spec:
  {{- if .Values.web.pdb.minAvailable }}
  minAvailable: {{ .Values.web.pdb.minAvailable }}
  {{- end }}
  {{- if .Values.web.pdb.maxUnavailable }}
  maxUnavailable: {{ .Values.web.pdb.maxUnavailable }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "laravel.deployment.selectorLabels" (dict "root" . "component" "web") | nindent 6 }}
{{- end }}

{{- range $workerName, $workerConfig := .Values.workers }}
{{- if and $workerConfig.enabled $workerConfig.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: {{ include "laravel.fullname" $ }}-worker-{{ $workerName }}
  labels:
    {{- include "laravel.deployment.labels" (dict "root" $ "component" (printf "worker-%s" $workerName)) | nindent 4 }}
spec:
  {{- if $workerConfig.pdb.minAvailable }}
  minAvailable: {{ $workerConfig.pdb.minAvailable }}
  {{- end }}
  {{- if $workerConfig.pdb.maxUnavailable }}
  maxUnavailable: {{ $workerConfig.pdb.maxUnavailable }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "laravel.deployment.selectorLabels" (dict "root" $ "component" (printf "worker-%s" $workerName)) | nindent 6 }}
{{- end }}
{{- end }}
